<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="coupon">

	<!-- SuperAdmin 쿠폰등록 -->
	<insert id="regist" parameterType="couponDto">
		insert into coupon values(
			coupon_seq.nextval, #{name}, #{issue_type}, #{discount_type},
			#{discount_price}, #{max_price}, SYSDATE, (SELECT SYSDATE + #{finish_date} FROM DUAL), 
			'발급중', SYSDATE, SYSDATE, #{auto_type}, #{issue_date}
		)
	</insert>
	
	<!-- 나의 쿠폰번호 구하기 -->
	<select id="get_coupon_code" parameterType="int" resultType="issueDto">
		select * from issue where member_code=#{member_code}
	</select>
	
	<!-- 나의 쿠폰정보 구하기 -->
	<select id="get_coupon_info" parameterType="int" resultType="couponDto">
		select * from coupon where no=#{coupon_code} order by no desc
	</select>
	<!-- 쿠폰정보 구하기 -->
	<select id="list" resultType="couponDto">
		select * from coupon 
	</select>
	<!-- 사용기간이 종료 되었는지 -->
	<select id="issue"  parameterType="map" resultType="int">
		SELECT #{finish_date} - SYSDATE FROM DUAL;
	</select>
	<!-- 사용상태 변경 -->
	<update id="finish" parameterType="map">
		update coupon set issue_status = '발급종료' where no = #{no}
	</update>
	
	<insert id="all" parameterType="map">
		insert into issue values(#{coupon_code},#{member_code},sysdate)
	</insert>
	
	<!-- 쿠폰갯수 구하기 -->
	<select id="getCouponCount" parameterType="int" resultType="int">
		select count(*) from issue where member_code=#{member_code}
	</select>
	
</mapper>